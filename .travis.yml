---

# https://docs.travis-ci.com/user/osx-ci-environment

os: osx

install:
  # Install pip
  - sudo easy_install pip
  # Install ansible
  # Keep this at 1.9.4 until the following issue is resolved:
  # https://github.com/ansible/ansible-modules-core/issues/2473
  # This is the "less noisey" technique for installing Ansible on Mac OS 10.9+
  # http://docs.ansible.com/ansible/intro_installation.html#latest-releases-via-pip
  - sudo CFLAGS=-Qunused-arguments CPPFLAGS=-Qunused-arguments pip install ansible==1.9.4
  # Install Ansible Lint
  - sudo pip install ansible-lint
  # Install Ansible Galaxy dependencies
  - ansible-galaxy install -r deps.yml
  # Update Homebrew & formulae
  - brew update
  # Debugging info
  - ansible --version
  - whoami
  - pwd

script:
  # Playbook syntax checks
  - ansible-playbook -i hosts plists.yml --syntax-check
  - ansible-playbook -i hosts main.yml --syntax-check

  # Playbook lint checks
  # https://github.com/willthames/ansible-lint
  # - ansible-lint plists.yml
  # - ansible-lint main.yml

  # Run Ansible playbook on host "mba" (preparatory tasks only):
  # - ansible-playbook -i hosts main.yml --limit mba --extra-vars "unix_username=travis" --tags "prep"

  # Run Ansible playbook on host "mba".
  # - Skip prep roles for now.
  # - Skip roles that cause CI issues.
  # - Skip roles that required Mac OS 10.10 or higher (Travis runs 10.9).
  - ansible-playbook -i hosts main.yml --limit mba --extra-vars "unix_username=travis" --skip-tags "prep,no_ci,mac_os_10_10,mac_os_10_11"
